//
// ActivityAPI.swift
//
// Generated by openapi-generator
// https://openapi-generator.tech
//

import Foundation
#if canImport(AnyCodable)
    import AnyCodable
#endif

extension TraqAPI {
    open class ActivityAPI {
        /**
         アクテビティタイムラインを取得

         - parameter limit: (query) 取得する件数 (optional, default to 50)
         - parameter all: (query) 全てのチャンネルのタイムラインを取得する (optional, default to false)
         - parameter perChannel: (query) 同じチャンネルのメッセージは最新のもののみ取得するか (optional, default to false)
         - returns: [ActivityTimelineMessage]
         */
        @available(macOS 10.15, iOS 13.0, tvOS 13.0, watchOS 6.0, *)
        open class func getActivityTimeline(limit: Int? = nil, all: Bool? = nil, perChannel: Bool? = nil) async throws -> [ActivityTimelineMessage] {
            var requestTask: RequestTask?
            return try await withTaskCancellationHandler {
                try Task.checkCancellation()
                return try await withCheckedThrowingContinuation { continuation in
                    guard !Task.isCancelled else {
                        continuation.resume(throwing: CancellationError())
                        return
                    }

                    requestTask = getActivityTimelineWithRequestBuilder(limit: limit, all: all, perChannel: perChannel).execute { result in
                        switch result {
                        case let .success(response):
                            continuation.resume(returning: response.body)
                        case let .failure(error):
                            continuation.resume(throwing: error)
                        }
                    }
                }
            } onCancel: { [requestTask] in
                requestTask?.cancel()
            }
        }

        /**
         アクテビティタイムラインを取得

         - parameter limit: (query) 取得する件数 (optional, default to 50)
         - parameter all: (query) 全てのチャンネルのタイムラインを取得する (optional, default to false)
         - parameter perChannel: (query) 同じチャンネルのメッセージは最新のもののみ取得するか (optional, default to false)
         - parameter apiResponseQueue: The queue on which api response is dispatched.
         - parameter completion: completion handler to receive the result
         */
        @discardableResult
        open class func getActivityTimeline(limit: Int? = nil, all: Bool? = nil, perChannel: Bool? = nil, apiResponseQueue: DispatchQueue = TraqAPI.apiResponseQueue, completion: @escaping ((_ result: Swift.Result<[ActivityTimelineMessage], ErrorResponse>) -> Void)) -> RequestTask {
            return getActivityTimelineWithRequestBuilder(limit: limit, all: all, perChannel: perChannel).execute(apiResponseQueue) { result in
                switch result {
                case let .success(response):
                    completion(.success(response.body))
                case let .failure(error):
                    completion(.failure(error))
                }
            }
        }

        /**
         アクテビティタイムラインを取得
         - GET /activity/timeline
         - パブリックチャンネルの直近の投稿メッセージを作成日時の降順で取得します。 `all`が`true`でない場合、購読チャンネルのみのタイムラインを取得します
         - OAuth:
           - type: oauth2
           - name: OAuth2
         - BASIC:
           - type: http
           - name: bearerAuth
         - parameter limit: (query) 取得する件数 (optional, default to 50)
         - parameter all: (query) 全てのチャンネルのタイムラインを取得する (optional, default to false)
         - parameter perChannel: (query) 同じチャンネルのメッセージは最新のもののみ取得するか (optional, default to false)
         - returns: RequestBuilder<[ActivityTimelineMessage]>
         */
        open class func getActivityTimelineWithRequestBuilder(limit: Int? = nil, all: Bool? = nil, perChannel: Bool? = nil) -> RequestBuilder<[ActivityTimelineMessage]> {
            let localVariablePath = "/activity/timeline"
            let localVariableURLString = TraqAPI.basePath + localVariablePath
            let localVariableParameters: [String: Any]? = nil

            var localVariableUrlComponents = URLComponents(string: localVariableURLString)
            localVariableUrlComponents?.queryItems = APIHelper.mapValuesToQueryItems([
                "limit": limit?.encodeToJSON(),
                "all": all?.encodeToJSON(),
                "per_channel": perChannel?.encodeToJSON(),
            ])

            let localVariableNillableHeaders: [String: Any?] = [:]

            let localVariableHeaderParameters = APIHelper.rejectNilHeaders(localVariableNillableHeaders)

            let localVariableRequestBuilder: RequestBuilder<[ActivityTimelineMessage]>.Type = TraqAPI.requestBuilderFactory.getBuilder()

            return localVariableRequestBuilder.init(method: "GET", URLString: localVariableUrlComponents?.string ?? localVariableURLString, parameters: localVariableParameters, headers: localVariableHeaderParameters)
        }

        /**
         オンラインユーザーリストを取得

         - returns: [String]
         */
        @available(macOS 10.15, iOS 13.0, tvOS 13.0, watchOS 6.0, *)
        open class func getOnlineUsers() async throws -> [String] {
            var requestTask: RequestTask?
            return try await withTaskCancellationHandler {
                try Task.checkCancellation()
                return try await withCheckedThrowingContinuation { continuation in
                    guard !Task.isCancelled else {
                        continuation.resume(throwing: CancellationError())
                        return
                    }

                    requestTask = getOnlineUsersWithRequestBuilder().execute { result in
                        switch result {
                        case let .success(response):
                            continuation.resume(returning: response.body)
                        case let .failure(error):
                            continuation.resume(throwing: error)
                        }
                    }
                }
            } onCancel: { [requestTask] in
                requestTask?.cancel()
            }
        }

        /**
         オンラインユーザーリストを取得

         - parameter apiResponseQueue: The queue on which api response is dispatched.
         - parameter completion: completion handler to receive the result
         */
        @discardableResult
        open class func getOnlineUsers(apiResponseQueue: DispatchQueue = TraqAPI.apiResponseQueue, completion: @escaping ((_ result: Swift.Result<[String], ErrorResponse>) -> Void)) -> RequestTask {
            return getOnlineUsersWithRequestBuilder().execute(apiResponseQueue) { result in
                switch result {
                case let .success(response):
                    completion(.success(response.body))
                case let .failure(error):
                    completion(.failure(error))
                }
            }
        }

        /**
         オンラインユーザーリストを取得
         - GET /activity/onlines
         - 現在オンラインな(SSEまたはWSが接続中)ユーザーのUUIDのリストを返します。
         - OAuth:
           - type: oauth2
           - name: OAuth2
         - BASIC:
           - type: http
           - name: bearerAuth
         - returns: RequestBuilder<[String]>
         */
        open class func getOnlineUsersWithRequestBuilder() -> RequestBuilder<[String]> {
            let localVariablePath = "/activity/onlines"
            let localVariableURLString = TraqAPI.basePath + localVariablePath
            let localVariableParameters: [String: Any]? = nil

            let localVariableUrlComponents = URLComponents(string: localVariableURLString)

            let localVariableNillableHeaders: [String: Any?] = [:]

            let localVariableHeaderParameters = APIHelper.rejectNilHeaders(localVariableNillableHeaders)

            let localVariableRequestBuilder: RequestBuilder<[String]>.Type = TraqAPI.requestBuilderFactory.getBuilder()

            return localVariableRequestBuilder.init(method: "GET", URLString: localVariableUrlComponents?.string ?? localVariableURLString, parameters: localVariableParameters, headers: localVariableHeaderParameters)
        }
    }
}
